<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì²´ìœ¡ê´€ ëª©ë¡</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .elasticGym-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      padding: 20px;
    }

    .elasticGym-card {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.2s;
    }

    .elasticGym-card:hover {
      transform: translateY(-5px);
    }

    .elasticGym-info {
      padding: 15px;
    }

    .elasticGym-name {
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .elasticGym-category {
      display: inline-block;
      padding: 3px 8px;
      background-color: #007bff;
      color: white;
      border-radius: 15px;
      font-size: 0.9em;
      margin-bottom: 10px;
    }

    .elasticGym-details {
      color: #666;
      font-size: 0.9em;
    }

    .elasticGym-rating {
      color: #f8c51c;
      font-weight: bold;
      margin-top: 10px;
    }

    /* ë¡œë”© í‘œì‹œë¥¼ ìœ„í•œ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
    .loading {
      text-align: center;
      padding: 20px;
      font-size: 1.2em;
      color: #666;
    }

    /* ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ìœ„í•œ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
    .error-message {
      background-color: #fff3f3;
      border: 1px solid #ffcdd2;
      color: #d32f2f;
      padding: 15px;
      border-radius: 5px;
      margin: 20px;
      text-align: center;
    }

    .debug-info {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-family: monospace;
      max-width: 400px;
      max-height: 200px;
      overflow: auto;
      z-index: 1000;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }

    .modal-content {
      background-color: #fff;
      margin: 5% auto;
      padding: 0;
      width: 90%;
      max-width: 800px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #eee;
      position: relative;
      background-color: #f8f9fa;
      border-radius: 10px 10px 0 0;
    }

    .modal-title {
      margin: 0;
      font-size: 1.5em;
      color: #333;
    }

    .close-button {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }

    .modal-body {
      padding: 20px;
    }

    .elasticGym-info {
      margin-bottom: 30px;
    }

    .elasticGym-header {
      margin-bottom: 20px;
    }

    .elasticGym-name {
      font-size: 1.8em;
      margin: 0 0 10px 0;
      color: #333;
    }

    .elasticGym-category {
      display: inline-block;
      padding: 5px 15px;
      background-color: #007bff;
      color: white;
      border-radius: 20px;
      font-size: 0.9em;
    }

    .elasticGym-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .info-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #eee;
    }

    .info-label {
      font-weight: bold;
      color: #666;
      margin-bottom: 8px;
      font-size: 0.9em;
    }

    .elasticGym-rating {
      color: #ffc107;
      font-size: 1.2em;
    }

    .elasticGym-reviews {
      border-top: 1px solid #eee;
      padding-top: 20px;
    }

    .elasticGym-reviews h3 {
      margin: 0 0 20px 0;
      color: #333;
    }

    .reviews-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .review-card {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #eee;
    }

    .review-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .review-rating {
      color: #ffc107;
    }

    .review-date {
      color: #666;
      font-size: 0.9em;
    }

    .review-content {
      color: #333;
      line-height: 1.5;
    }

    .review-card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .review-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .reviewer-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .reviewer-profile {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }

    .reviewer-details {
      display: flex;
      flex-direction: column;
    }

    .reviewer-name {
      font-weight: 600;
      font-size: 1rem;
      color: #333;
      margin-bottom: 2px;
    }

    .review-date {
      font-size: 0.85rem;
      color: #888;
    }

    .review-rating {
      color: #ffc107;
      font-size: 0.9rem;
    }

    .review-content {
      margin: 15px 0;
      line-height: 1.5;
      color: #444;
    }

    .review-images {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding: 10px 0;
    }

    .review-image {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 8px;
    }

    .review-actions {
      margin-top: 15px;
      display: flex;
      align-items: center;
    }

    .comment-button {
      display: flex;
      align-items: center;
      gap: 5px;
      background: none;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      color: #666;
      font-size: 0.9rem;
    }

    .comment-button:hover {
      color: #333;
    }

    .comment-icon {
      font-size: 1.2rem;
    }

    .comment-count {
      color: #666;
    }
  </style>
</head>
<body>
  <div class="elasticGym-container" id="gymContainer">

    <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
    <div id="error" class="error-message" style="display: none;"></div>

    <!-- ë””ë²„ê·¸ ì •ë³´ë¥¼ í‘œì‹œí•  div ì¶”ê°€ -->
    <div id="debugInfo" class="debug-info"></div>

    <div class="elasticGym-card" onclick="location.href='/elasticGyms/1'">
      <div class="elasticGym-info">
        <div class="elasticGym-name">ì²´ìœ¡ê´€ ì´ë¦„</div>
        <div class="elasticGym-category">ì²´ìœ¡ê´€ ì¹´í…Œê³ ë¦¬</div>
        <div class="elasticGym-details">
          <div>ì£¼ì†Œ</div>
          <div>ìš´ì˜ì‹œê°„ ì •ë³´ ì—†ìŒ</div>
        </div>
        <div class="elasticGym-rating">â˜… N/A</div>
      </div>
    </div>
    <div class="elasticGym-card" onclick="location.href='/elasticGyms/2'">
      <div class="elasticGym-info">
        <div class="elasticGym-name">ì²´ìœ¡ê´€ ì´ë¦„</div>
        <div class="elasticGym-category">ì²´ìœ¡ê´€ ì¹´í…Œê³ ë¦¬</div>
        <div class="elasticGym-details">
          <div>ì£¼ì†Œ</div>
          <div>ìš´ì˜ì‹œê°„ ì •ë³´ ì—†ìŒ</div>
        </div>
        <div class="elasticGym-rating">â˜…</div>
      </div>
    </div>
  </div>
  <!-- íŒì—… ëª¨ë‹¬ ì¶”ê°€ -->
  <div id="gymModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">ì²´ìœ¡ê´€ ìƒì„¸ ì •ë³´</h2>
        <span class="close-button" onclick="closeModal()">&times;</span>
      </div>
      <div id="gymDetailContent" class="modal-body">
        <div class="elasticGym-info">
          <div class="elasticGym-header">
            <h3 class="elasticGym-name"></h3>
            <div class="elasticGym-category"></div>
          </div>

          <div class="elasticGym-info-grid">
            <div class="info-item">
              <div class="info-label">í‰ì </div>
              <div class="elasticGym-rating"></div>
            </div>
            <div class="info-item">
              <div class="info-label">ì£¼ì†Œ</div>
              <div class="elasticGym-address"></div>
            </div>
            <div class="info-item">
              <div class="info-label">ìš´ì˜ì‹œê°„</div>
              <div class="elasticGym-hours"></div>
            </div>
            <div class="info-item">
              <div class="info-label">ì—°ë½ì²˜</div>
              <div class="elasticGym-phone"></div>
            </div>
            <div class="info-item">
              <div class="info-label">í™ˆí˜ì´ì§€</div>
              <div class="elasticGym-homepage"></div>
            </div>
          </div>
        </div>

        <div class="elasticGym-reviews">
          <h3>ë¦¬ë·°</h3>
          <div class="reviews-container"></div>
        </div>
      </div>
    </div>
  </div>

  <script>

    function fetchGyms() {
      const container = document.getElementById('gymContainer');
      const loading = document.getElementById('loading');
      const errorDiv = document.getElementById('error');

      // debugInfo ìš”ì†Œ í™•ì¸ í›„ ì‚¬ìš©
      const debugInfo = document.getElementById('debugInfo');
      const isDebugMode = debugInfo !== null;

      // ë¡œë”© í‘œì‹œ
      if (loading) {
        loading.style.display = 'block';
      }
      if (errorDiv) {
        errorDiv.style.display = 'none';
      }

      console.log('API í˜¸ì¶œ ì‹œì‘');
      // debugInfoê°€ ìˆì„ ë•Œë§Œ ì‚¬ìš©
      if (isDebugMode) {
        debugInfo.innerHTML = 'ë°ì´í„° ë¡œë”© ì¤‘...';
      }

      fetch('/api/elasticGyms', {
        credentials: 'include',
        headers: {
          'Accept': 'application/json'
        }
      })
              .then(response => {
                console.log('API ì‘ë‹µ ìƒíƒœ:', response.status);
                if (isDebugMode) {
                  debugInfo.innerHTML += `<br>ì‘ë‹µ ìƒíƒœ: ${response.status}`;
                }

                if (!response.ok) {
                  throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
              })
              .then(elasticGyms => {
                console.log('ë°›ì€ ë°ì´í„°:', elasticGyms);
                if (isDebugMode) {
                  debugInfo.innerHTML += `<br>ë°›ì€ ë°ì´í„°: ${JSON.stringify(elasticGyms, null, 2)}`;
                }

                if (loading) {
                  loading.style.display = 'none';
                }

                if (container) {
                  container.innerHTML = '';

                  if (!Array.isArray(elasticGyms)) {
                    throw new Error('ë°ì´í„°ê°€ ë°°ì—´ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
                  }

                  elasticGyms.forEach(elasticGym => {
                    const gymCard = document.createElement('div');
                    gymCard.className = 'elasticGym-card';
                    gymCard.onclick = () => {
                      console.log('ì¹´ë“œ í´ë¦­ë¨:', elasticGym.gymId);
                      showGymDetail(elasticGym.gymId);
                    };

                    gymCard.innerHTML = `
                    <div class="elasticGym-info">
                        <div class="elasticGym-name">${elasticGym.gname || 'ì´ë¦„ ì—†ìŒ'}</div>
                        <div class="elasticGym-category">${translateCategory(elasticGym.category)}</div>
                        <div class="elasticGym-details">
                            <div>${elasticGym.address || 'ì£¼ì†Œ ì—†ìŒ'}</div>
                        </div>
                        <div class="elasticGym-rating">â˜… ${elasticGym.rating || 'N/A'}</div>
                    </div>
                `;

                    container.appendChild(gymCard);
                  });
                }
              })
              .catch(error => {
                console.error('Error:', error);
                if (isDebugMode) {
                  debugInfo.innerHTML += `<br>ì—ëŸ¬ ë°œìƒ: ${error.message}`;
                }
                if (loading) {
                  loading.style.display = 'none';
                }
                if (errorDiv) {
                  errorDiv.style.display = 'block';
                  errorDiv.textContent = 'ì²´ìœ¡ê´€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (' + error.message + ')';
                }
              });
    }

    // ë‚˜ë¨¸ì§€ í•¨ìˆ˜ë“¤ (showGymDetail, closeModal ë“±) ìœ ì§€
    function showGymDetail(gymId) {
      const modal = document.getElementById('gymModal');
      const detailContent = document.getElementById('gymDetailContent');

      if (!modal || !detailContent) {
        console.error('ëª¨ë‹¬ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      modal.style.display = 'block';

      fetch(`/api/elasticGym/${gymId}`, {
        credentials: 'include',
        headers: {
          'Accept': 'application/json'
        }
      })
              .then(response => response.json())
              .then(data => {
                console.log('ë°›ì€ ë°ì´í„°2 :', data );
                detailContent.innerHTML = `
           <div class="elasticGym-info">
               <div class="elasticGym-header">
                   <h3 class="elasticGym-name">${data.gName || 'ì´ë¦„ ì—†ìŒ'}</h3>
                   <div class="elasticGym-category">${translateCategory(data.category) || 'ì¹´í…Œê³ ë¦¬ ì—†ìŒ'}</div>
               </div>

               <div class="elasticGym-info-grid">
                   <div class="info-item">
                       <div class="info-label">í‰ì </div>
                       <div class="elasticGym-rating">â˜… ${data.rating || 'N/A'}</div>
                   </div>
                   <div class="info-item">
                       <div class="info-label">ì£¼ì†Œ</div>
                       <div class="elasticGym-address">${data.address || 'ì •ë³´ ì—†ìŒ'}</div>
                   </div>
                   <div class="info-item">
                       <div class="info-label">ìš´ì˜ì‹œê°„</div>
                       <div class="elasticGym-hours">${data.openHour || 'ì •ë³´ ì—†ìŒ'}</div>
                   </div>
                   <div class="info-item">
                       <div class="info-label">ì—°ë½ì²˜</div>
                       <div class="elasticGym-phone">${data.phone || 'ì •ë³´ ì—†ìŒ'}</div>
                   </div>
                   <div class="info-item">
                       <div class="info-label">í™ˆí˜ì´ì§€</div>
                       <div class="elasticGym-homepage">${data.homepage ?
                        `<a href="${data.homepage}" target="_blank">${data.homepage}</a>` :
                        'ì •ë³´ ì—†ìŒ'}</div>
                   </div>
               </div>
           </div>

           <div class="elasticGym-reviews">
               <h3>ë¦¬ë·°</h3>
            <div class="reviews-container">
                ${data.reviews && data.reviews.length > 0 ?
                        data.reviews.map(review => {
                          console.log('ê° ë¦¬ë·°:', review);  // ê° ë¦¬ë·° ê°ì²´ í™•ì¸ìš©
                          return `
                            <div class="review-card">
                                <div class="review-header">
                                    <div class="reviewer-info">
                                        <img src="${review.userProfileImage || '/default-profile.png'}"
                                             alt="í”„ë¡œí•„"
                                             class="reviewer-profile">
                                        <div class="reviewer-details">
                                            <div class="reviewer-name">${review.userName || 'ì‚¬ìš©ì'}</div>
                                        </div>
                                    </div>
                                    <div class="review-date">${new Date(review.createdAt).toLocaleDateString()}</div>
                                </div>
                                <div class="review-content">
                                    ${Array.isArray(review.content) ? review.content.join(' ') : review.content || 'ë‚´ìš© ì—†ìŒ'}
                                </div>
                                <div class="review-actions">
                                    <button class="comment-button">
                                        <i class="comment-icon">ğŸ’¬</i>
                                        <span class="comment-count">0</span>
                                    </button>
                                </div>
                            </div>
                        `;
                        }).join('') :
                        '<p>ì•„ì§ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'
                }
            </div>
           </div>
       `;
              })
              .catch(error => {
                console.error('ì—ëŸ¬:', error);
                detailContent.innerHTML = `
           <div class="error-message">
               ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}
           </div>
       `;
              });
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return new Intl.DateTimeFormat('ko-KR', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      }).format(date);
    }

    function translateCategory(category) {
      const categories = {
        'physics': 'í”¼íŠ¸ë‹ˆìŠ¤',
        'water': 'ìˆ˜ì˜',
        'ball': 'êµ¬ê¸°ì¢…ëª©',
        'battle': 'ê²©íˆ¬ê¸°'
      };
      return categories[category] || category;
    }

    function closeModal() {
      const modal = document.getElementById('gymModal');
      modal.style.display = 'none';
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
      const modal = document.getElementById('gymModal');
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    }

    // í˜ì´ì§€ ë¡œë“œì‹œ ì‹¤í–‰
    document.addEventListener('DOMContentLoaded', fetchGyms);
  </script>
</body>
</html>