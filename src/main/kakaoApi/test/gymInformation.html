<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Kakao Map으로 헬스장 정보 가져오기</title>
  <style>
        #map {
            width: 100%;
            height: 400px;
        }
        #list {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: scroll;
        }
        .item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
        }
    </style>
</head>
<body>
<h1>헬스장 정보 가져오기</h1>
<div id="map"></div>
<div id="list"></div>

<!-- Kakao Maps JavaScript API -->
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=023855f0a78a87bb9407e335c59f0005&libraries=services"></script>
<script>
        // 카카오 지도 생성
        var mapContainer = document.getElementById('map'),
            mapOption = {
                center: new kakao.maps.LatLng(37.566535, 126.9779692), // 지도 중심점 (서울 시청)
                level: 5 // 지도의 확대 레벨
            };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 장소 검색 객체 생성
        var ps = new kakao.maps.services.Places();

        // '헬스장' 키워드로 장소 검색
        ps.keywordSearch('헬스장', placesSearchCB, {
            size: 15 // 한 번에 가져올 헬스장 수
        });

        // 검색 결과를 처리하는 콜백 함수
        function placesSearchCB(data, status, pagination) {
            if (status === kakao.maps.services.Status.OK) {
                displayPlaces(data); // 결과를 화면에 표시
                displayMarkers(data); // 지도에 마커 표시
            } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
                alert('검색 결과가 없습니다.');
            } else if (status === kakao.maps.services.Status.ERROR) {
                alert('검색 결과 중 오류가 발생했습니다.');
            }
        }

        // 헬스장 목록을 화면에 표시하는 함수
        function displayPlaces(places) {
            var listEl = document.getElementById('list');
            listEl.innerHTML = ''; // 이전 검색 결과 삭제

            for (var i = 0; i < places.length; i++) {
                var itemEl = getListItem(i, places[i]);
                listEl.appendChild(itemEl);
            }
        }

        // 리스트 아이템을 생성하는 함수
        function getListItem(index, place) {
            var el = document.createElement('div');
            el.className = 'item';
            el.innerHTML = `<strong>${place.place_name}</strong><br>
                            ${place.road_address_name || place.address_name}<br>
                            ${place.phone}`;
            el.onclick = function() {
                map.setCenter(new kakao.maps.LatLng(place.y, place.x)); // 지도 중심 이동
            };
            return el;
        }

        // 헬스장 위치에 마커를 표시하는 함수
        function displayMarkers(places) {
            for (var i = 0; i < places.length; i++) {
                var marker = new kakao.maps.Marker({
                    map: map,
                    position: new kakao.maps.LatLng(places[i].y, places[i].x)
                });

                // 마커에 클릭 이벤트를 등록하여 장소명을 표시
                (function(marker, place) {
                    kakao.maps.event.addListener(marker, 'click', function() {
                        alert(place.place_name);
                    });
                })(marker, places[i]);
            }
        }
    </script>
</body>
</html>
